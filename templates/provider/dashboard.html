{% extends "base.html" %}

{% block title %}Provider Dashboard - Scholarsphere | University of Cebu{% endblock %}

{% block extra_css %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background: #f8f9fa;
        color: #333;
    }

    .dashboard-container {
        display: flex;
        min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
        width: 280px;
        background: linear-gradient(135deg, #003366 0%, #0072ce 100%);
        color: white;
        padding: 2rem 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
    }

    .sidebar-header {
        text-align: center;
        padding: 0 2rem 2rem 2rem;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar-logo {
        width: 60px;
        height: 60px;
        background: white;
        border-radius: 50%;
        margin: 0 auto 1rem auto;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .sidebar-logo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }

    .sidebar-brand {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .sidebar-subtitle {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .sidebar-nav {
        padding: 2rem 0;
    }
    
    .sidebar-guidelines-btn {
        background: rgba(255,255,255,0.1) !important;
        border: 1px solid rgba(255,255,255,0.2) !important;
        color: #fff !important;
    }
    .sidebar-guidelines-btn:hover {
        background: rgba(255,255,255,0.2) !important;
        transform: translateY(-2px);
    }

    .nav-item {
        padding: 1rem 2rem;
        cursor: pointer;
        transition: background 0.3s;
        border-left: 3px solid transparent;
    }

    .nav-item:hover, .nav-item.active {
        background: rgba(255,255,255,0.1);
        border-left-color: #ffc72c;
    }

    .nav-item i {
        margin-right: 1rem;
        width: 20px;
    }

    /* Main Content */
    .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 2rem;
    }

    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1rem 0;
    }

    .welcome-text h1 {
        font-size: 2rem;
        color: #003366;
        margin-bottom: 0.5rem;
    }

    .welcome-text p {
        color: #666;
    }

    .user-menu {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #0072ce;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        cursor: pointer;
    }

    /* Dashboard Cards */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .dashboard-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        transition: transform 0.3s;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
    }

    .card-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .card-header i {
        font-size: 2rem;
        color: #0072ce;
        margin-right: 1rem;
    }

    .card-header h3 {
        font-size: 1.3rem;
        color: #003366;
    }

    .card-content {
        color: #666;
        line-height: 1.6;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 1rem;
    }

    .stat-item {
        text-align: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #0072ce;
        display: block;
    }

    .stat-label {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .sidebar {
            width: 250px;
        }
        .main-content {
            margin-left: 250px;
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .main-content {
            margin-left: 0;
        }
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }
.btn-report{ background: linear-gradient(135deg,#e63946 0%, #ff6b6b 100%); color:#fff; padding:.5rem 1rem; border-radius:10px; font-weight:700; box-shadow:0 6px 16px rgba(230,57,70,.28); display:inline-flex; align-items:center; gap:.5rem; }
    .btn-report:hover{ filter:brightness(.95); transform: translateY(-1px);} 
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                {% if user.profile_picture %}
                  <img id="sidebarProfilePicture" src="{{ url_for('static', filename='uploads/profile_pictures/' + user.profile_picture) }}" alt="Profile Picture">
                {% else %}
                  <img id="sidebarProfilePicture" src="{{ url_for('static', filename='images/uc-logo.png') }}" alt="UC Logo">
                {% endif %}
            </div>
            <div class="sidebar-brand">Scholarsphere</div>
            <div class="sidebar-subtitle">Provider Portal</div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-item active">
                <i class="fas fa-home"></i> Dashboard
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('provider.scholarships') }}'">
                <i class="fas fa-graduation-cap"></i> Manage Scholarships
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('provider.applications') }}'">
                <i class="fas fa-clipboard-list"></i> Applications
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('provider.schedules') }}'">
                <i class="fas fa-calendar-alt"></i> Schedules
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('provider.documents') }}'">
                <i class="fas fa-file-alt"></i> Documents
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('provider.profile') }}'">
                <i class="fas fa-building"></i> Organization Profile
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('logout') }}'">
                <i class="fas fa-sign-out-alt"></i> Logout
            </div>
        </nav>
        <div style="padding: 1rem 1.5rem; margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
            <button onclick="openProviderGuidelinesModal()" class="sidebar-guidelines-btn" style="padding: 0.75rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.9rem; width: 100%; text-align: center; transition: all 0.3s; border: 1px solid rgba(255,255,255,0.2);">
                <i class="fas fa-info-circle"></i> Guidelines
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="welcome-text">
                <h1>Welcome, University of Cebu!</h1>
                <p>Provider ID: PRV-001 | Organization: University of Cebu Main Campus</p>
            </div>
            <div class="user-menu">
<a class="btn-report" href="{{ url_for('provider.generate_report_pdf') }}" style="text-decoration:none;">
                    <i class="fas fa-file-pdf"></i> Generate PDF Report
                </a>
                <div class="user-avatar" onclick="window.location.href='{{ url_for('provider.profile') }}'">
                    UC
                </div>
            </div>
        </div>

        <!-- Dashboard Overview -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-graduation-cap"></i>
                    <h3>Active Scholarships</h3>
                </div>
                <div class="card-content">
                    <p>Currently active scholarship programs</p>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number">{{ data.stats.active_scholarships }}</span>
                            <div class="stat-label">Active</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ data.stats.draft_scholarships }}</span>
                            <div class="stat-label">Draft</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-users"></i>
                    <h3>Total Applications</h3>
                </div>
                <div class="card-content">
                    <p>Applications received this month</p>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number">{{ data.stats.total_applications }}</span>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ data.stats.new_applications }}</span>
                            <div class="stat-label">New</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-clock"></i>
                    <h3>Pending Reviews</h3>
                </div>
                <div class="card-content">
                    <p>Applications awaiting review</p>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number">{{ data.stats.pending_reviews }}</span>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ data.stats.today_reviews }}</span>
                            <div class="stat-label">Today</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Send Announcements Section -->
        <div class="dashboard-card" style="margin-top: 2rem; overflow: visible;">
            <div class="card-header">
                <i class="fas fa-bullhorn"></i>
                <h3>Send Announcements</h3>
            </div>
            <div class="card-content" style="overflow: visible;">
                <p>Send announcements to students - all applicants or specific individuals</p>
                
                <!-- Tabs for announcement types -->
                <div class="announcement-tabs" style="margin-top: 1.5rem; border-bottom: 2px solid #e9ecef;">
                    <button class="announcement-tab active" onclick="switchAnnouncementTab('all')">
                        <i class="fas fa-users"></i> Announce to All (Scholarship)
                    </button>
                    <button class="announcement-tab" onclick="switchAnnouncementTab('specific')">
                        <i class="fas fa-user"></i> Announce to Specific Student
                    </button>
                </div>

                <!-- Announce to All Form -->
                <div id="announceToAllForm" class="announcement-form" style="display: block; margin-top: 1.5rem;">
                    <div class="form-group" style="position: relative;">
                        <label>Select Scholarship *</label>
                        <input type="text" id="scholarshipInput" class="form-control" placeholder="Type to search scholarship..." autocomplete="off">
                        <input type="hidden" id="scholarshipId">
                        <div id="scholarshipAutocompleteList" class="autocomplete-items"></div>
                    </div>
                    <div class="form-group">
                        <label>Recipient Filter (Optional)</label>
                        <select id="statusSelect" class="form-control">
                            <option value="all">All Applicants</option>
                            <option value="approved">Approved Only</option>
                            <option value="pending">Pending Only</option>
                            <option value="rejected">Rejected Only</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="announceAllTitle" class="form-control" placeholder="e.g., Important Update, Document Request" required>
                    </div>
                    <div class="form-group">
                        <label>Message *</label>
                        <textarea id="announceAllMessage" class="form-control" rows="4" placeholder="Enter your announcement message here..." required></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button type="button" class="btn-announce-submit" onclick="sendAnnouncementToAll()">
                            <i class="fas fa-paper-plane"></i> Send Announcement
                        </button>
                    </div>
                </div>

                <!-- Announce to Specific Form -->
                <div id="announceToSpecificForm" class="announcement-form" style="display: none; margin-top: 1.5rem;">
                    <div class="form-group" style="position: relative; z-index: 1;">
                        <label>Recipient (Name, ID, or Email) *</label>
                        <input type="text" id="studentInput" class="form-control" placeholder="Start typing to search..." autocomplete="off">
                        <input type="hidden" id="selectedStudentId">
                        <input type="hidden" id="selectedStudentEmail">
                        <div id="studentAutocompleteList" class="autocomplete-items" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="announceSpecificTitle" class="form-control" placeholder="e.g., Important Update, Document Request" required>
                    </div>
                    <div class="form-group">
                        <label>Message *</label>
                        <textarea id="announceSpecificMessage" class="form-control" rows="4" placeholder="Enter your announcement message here..." required></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button type="button" class="btn-announce-submit" onclick="sendAnnouncementToSpecific()">
                            <i class="fas fa-paper-plane"></i> Send to Student
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Announcement History Section -->
        <div class="dashboard-card" style="margin-top: 2rem;">
            <div class="card-header">
                <i class="fas fa-history"></i>
                <h3>Announcement History</h3>
            </div>
            <div class="card-content">
                <div style="margin-bottom: 1rem; display: flex; gap: 1rem;">
                    <input type="text" id="historySearch" class="form-control" placeholder="Search announcements by title..." oninput="debounceHistorySearch()">
                    <button class="btn-announce-submit" style="padding: 0.5rem 1rem; white-space: nowrap;" onclick="loadAnnouncementHistory()">Search</button>
                </div>
                
                <div id="announcementHistoryList" style="margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 2rem; color: #666;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <div>Loading announcement history...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Announcement Success Modal -->
<div id="announcementSuccessModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:600px;">
        <div class="modal-header">
            <h2 class="modal-title">Announcement Sent</h2>
            <button class="close" onclick="closeAnnouncementSuccess()">&times;</button>
        </div>
        <div class="modal-body" id="announcementSuccessBody" style="padding:2rem;"></div>
        <div class="modal-footer">
            <button type="button" class="btn-modal secondary" onclick="closeAnnouncementSuccess()">Close</button>
        </div>
    </div>
</div>

<style>
.announcement-tabs { display: flex; gap: 0; }
.announcement-tab { 
    flex: 1; 
    padding: 1rem; 
    background: #f8f9fa; 
    border: none; 
    border-bottom: 3px solid transparent;
    cursor: pointer; 
    font-weight: 600; 
    color: #666;
    transition: all 0.3s;
}
.announcement-tab:hover { background: #e9ecef; color: #0072ce; }
.announcement-tab.active { 
    background: white; 
    color: #0072ce; 
    border-bottom-color: #0072ce;
}
.announcement-form { padding: 1rem 0; overflow: visible; }
.form-group { margin-bottom: 1.5rem; }
.form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333; }
.form-control { 
    width: 100%; 
    padding: 0.75rem; 
    border: 1px solid #ddd; 
    border-radius: 8px; 
    font-size: 1rem; 
    box-sizing: border-box;
}
.form-control:focus { outline: none; border-color: #0072ce; box-shadow: 0 0 0 3px rgba(0,114,206,0.1); }
.btn-announce-submit {
    background: linear-gradient(135deg, #0072ce 0%, #003366 100%);
    color: white;
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: transform 0.2s;
}
.btn-announce-submit:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,114,206,0.3); }
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
.modal-content { background:#fff; margin:2% auto; padding:0; border-radius:15px; width:90%; max-width:600px; box-shadow:0 10px 30px rgba(0,0,0,0.3); }
.modal-header { padding:1.5rem; border-bottom:1px solid #e9ecef; background:#f8f9fa; border-radius:15px 15px 0 0; display:flex; justify-content:space-between; align-items:center; }
.modal-title { font-size:1.5rem; font-weight:700; color:#003366; margin:0; }
.close { background:none; border:none; font-size:2rem; color:#666; cursor:pointer; padding:0; width:30px; height:30px; display:flex; align-items:center; justify-content:center; }
.close:hover { color:#000; }
.modal-body { padding:2rem; }
.modal-footer { padding:1.5rem; border-top:1px solid #e9ecef; background:#f8f9fa; border-radius:0 0 15px 15px; display:flex; justify-content:flex-end; gap:1rem; }
.btn-modal { padding:0.75rem 1.5rem; border:none; border-radius:8px; font-weight:600; cursor:pointer; }
.btn-modal.secondary { background:#6c757d; color:#fff; }
.btn-modal.secondary:hover { background:#545b62; }

/* Autocomplete styles */
.autocomplete-items {
  position: absolute !important;
  top: 100% !important;
  left: 0 !important;
  background: #fff !important;
  border: 1px solid #ddd !important;
  border-top: none !important;
  border-radius: 0 0 8px 8px !important;
  max-height: 300px !important;
  overflow-y: auto !important;
  z-index: 9999 !important;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
  box-sizing: border-box !important;
  margin-top: 0 !important;
}
.autocomplete-items div,
.autocomplete-items .autocomplete-suggestion {
  padding: 0.75rem !important;
  cursor: pointer !important;
  border-bottom: 1px solid #f0f0f0 !important;
  transition: background 0.2s;
  background-color: #fff !important;
  color: #333 !important;
}
.autocomplete-items div:last-child,
.autocomplete-items .autocomplete-suggestion:last-child {
  border-bottom: none !important;
}
.autocomplete-items div:hover,
.autocomplete-items .autocomplete-suggestion:hover {
  background: #f8f9fa !important;
}
.autocomplete-active,
.autocomplete-suggestion.active {
  background: #e3f2fd !important;
}
</style>

<script>
let scholarshipsList = [];
let announcementsCache = [];

// Load scholarships on page load
document.addEventListener('DOMContentLoaded', function() {
    loadScholarships();
    loadAnnouncementHistory();
    // Initialize student autocomplete
    initializeStudentAutocomplete();
});

function loadScholarships() {
    fetch('/provider/api/scholarships/list')
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                scholarshipsList = data.scholarships;
                setupClientSideAutocomplete(document.getElementById("scholarshipInput"), scholarshipsList);
            }
        })
        .catch(err => console.error('Error loading scholarships:', err));
}

function switchAnnouncementTab(type) {
    document.querySelectorAll('.announcement-tab').forEach(tab => {
        tab.classList.remove('active');
        if ((type === 'all' && tab.textContent.includes('All')) || 
            (type === 'specific' && tab.textContent.includes('Specific'))) {
            tab.classList.add('active');
        }
    });
    
    if (type === 'all') {
        document.getElementById('announceToAllForm').style.display = 'block';
        document.getElementById('announceToSpecificForm').style.display = 'none';
    } else {
        document.getElementById('announceToAllForm').style.display = 'none';
        document.getElementById('announceToSpecificForm').style.display = 'block';
        
        // Initialize autocomplete when switching to specific student tab
        setTimeout(function() {
            initializeStudentAutocomplete();
        }, 100);
    }
}

function sendAnnouncementToAll() {
    const scholarshipId = document.getElementById('scholarshipId').value;
    const statusFilter = document.getElementById('statusSelect').value;
    const title = document.getElementById('announceAllTitle').value.trim();
    const message = document.getElementById('announceAllMessage').value.trim();
    
    if (!scholarshipId) {
        showNotification('Please select a valid scholarship from the list', 'error');
        return;
    }
    if (!title || !message) {
        showNotification('Please fill in both title and message', 'error');
        return;
    }
    
    if (!confirm('Are you sure you want to send this announcement?')) {
        return;
    }
    
    const btn = document.querySelector('#announceToAllForm .btn-announce-submit');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
    btn.disabled = true;
    
    fetch(`/provider/api/announcement/scholarship/${scholarshipId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, message, status_filter: statusFilter })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            document.getElementById('scholarshipInput').value = '';
            document.getElementById('scholarshipId').value = '';
            document.getElementById('announceAllTitle').value = '';
            document.getElementById('announceAllMessage').value = '';
            
            const body = document.getElementById('announcementSuccessBody');
            body.innerHTML = `
                <div style="display:grid; gap:.75rem;">
                    <div><strong>Status:</strong> Success</div>
                    <div><strong>Message:</strong> ${data.message}</div>
                    <div style="margin-top:1rem; padding:1rem; background:#d4edda; border-radius:8px; color:#155724;">
                        Announcement sent to ${data.recipient_count} student(s) for scholarship: ${data.scholarship}
                    </div>
                </div>
            `;
            document.getElementById('announcementSuccessModal').style.display = 'block';
            loadAnnouncementHistory();
        } else {
            showNotification('Error: ' + (data.error || 'Failed to send announcement'), 'error');
        }
    })
    .catch(err => {
        console.error('Error:', err);
        showNotification('Error sending announcement. Please try again.', 'error');
    })
    .finally(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
    });
}

function sendAnnouncementToSpecific() {
    const recipientInput = document.getElementById('studentInput').value.trim();
    const title = document.getElementById('announceSpecificTitle').value.trim();
    const message = document.getElementById('announceSpecificMessage').value.trim();
    
    if (!recipientInput) {
        showNotification('Please enter a recipient (Name, ID, or Email)', 'error');
        return;
    }
    if (!title || !message) {
        showNotification('Please fill in both title and message', 'error');
        return;
    }
    
    // Use the input value which should be in format "Name (ID)" if selected from autocomplete
    const recipient = recipientInput;
    
    const btn = document.querySelector('#announceToSpecificForm .btn-announce-submit');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
    btn.disabled = true;
    
    fetch(`/provider/api/announcement/individual`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ recipient, title, message })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            document.getElementById('studentInput').value = '';
            document.getElementById('announceSpecificTitle').value = '';
            document.getElementById('announceSpecificMessage').value = '';
            
            const body = document.getElementById('announcementSuccessBody');
            body.innerHTML = `
                <div style="display:grid; gap:.75rem;">
                    <div><strong>Status:</strong> Success</div>
                    <div><strong>Message:</strong> Announcement sent successfully.</div>
                    <div style="margin-top:1rem; padding:1rem; background:#d4edda; border-radius:8px; color:#155724;">
                        The student has been notified.
                    </div>
                </div>
            `;
            document.getElementById('announcementSuccessModal').style.display = 'block';
            loadAnnouncementHistory();
        } else {
            showNotification('Error: ' + (data.error || 'Failed to send announcement'), 'error');
        }
    })
    .catch(err => {
        console.error('Error:', err);
        showNotification('Error sending announcement. Please try again.', 'error');
    })
    .finally(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
    });
}

// Student Autocomplete - Initialize function
let studentAutocompleteInitialized = false;
let studentAutocompleteDebounceTimer = null;
let studentAutocompleteSelectedIndex = -1;
let studentAutocompleteSuggestions = [];

function initializeStudentAutocomplete() {
    const input = document.getElementById('studentInput');
    const suggestions = document.getElementById('studentAutocompleteList');
    
    if (!input || !suggestions) {
        console.log('Student autocomplete elements not found yet');
        return;
    }
    
    // Skip if already initialized
    if (input.hasAttribute('data-autocomplete-initialized')) {
        return;
    }
    
    input.setAttribute('data-autocomplete-initialized', 'true');
    
    input.addEventListener('input', function() {
        const query = this.value.trim();
        clearTimeout(studentAutocompleteDebounceTimer);
        studentAutocompleteSelectedIndex = -1;
        
        // Clear selected student when input changes
        const selectedStudentIdEl = document.getElementById('selectedStudentId');
        const selectedStudentEmailEl = document.getElementById('selectedStudentEmail');
        if (selectedStudentIdEl) selectedStudentIdEl.value = '';
        if (selectedStudentEmailEl) selectedStudentEmailEl.value = '';
        
        if (query.length < 2) {
            const suggestionsEl = document.getElementById('studentAutocompleteList');
            if (suggestionsEl) {
                suggestionsEl.style.display = 'none';
                suggestionsEl.innerHTML = '';
            }
            return;
        }
        
        studentAutocompleteDebounceTimer = setTimeout(() => {
            // Re-query the element to ensure we have a fresh reference
            // Make sure the form is visible first
            const form = document.getElementById('announceToSpecificForm');
            if (!form || window.getComputedStyle(form).display === 'none') {
                console.log('Form is hidden, skipping autocomplete');
                return;
            }
            
            let suggestionsEl = document.getElementById('studentAutocompleteList');
            if (!suggestionsEl) {
                console.error('Suggestions element not found - creating it');
                // Create the element if it doesn't exist
                const formGroup = input.parentElement;
                if (formGroup) {
                    suggestionsEl = document.createElement('div');
                    suggestionsEl.id = 'studentAutocompleteList';
                    suggestionsEl.className = 'autocomplete-items';
                    suggestionsEl.style.display = 'none';
                    formGroup.appendChild(suggestionsEl);
                    console.log('Created suggestions element');
                } else {
                    console.error('Cannot find form-group parent');
                    return;
                }
            }
            
            // Ensure element is connected
            if (!suggestionsEl.isConnected) {
                console.warn('Suggestions element not connected - reconnecting');
                const formGroup = input.parentElement;
                if (formGroup) {
                    formGroup.appendChild(suggestionsEl);
                    console.log('Reconnected suggestions element');
                }
            }
            
            fetch(`/provider/api/students/search?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    studentAutocompleteSuggestions = data || [];
                    
                    if (!data || data.length === 0) {
                        suggestionsEl.style.display = 'none';
                        suggestionsEl.innerHTML = '';
                        return;
                    }
                    
                    // Generate HTML for all suggestions at once (like applications.html)
                    suggestionsEl.innerHTML = data.map((item, index) => {
                        const displayText = item.display || `${item.name} (${item.student_id})`;
                        // Highlight matching text
                        const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`(${escapedQuery})`, "gi");
                        const highlighted = displayText.replace(regex, "<strong>$1</strong>");
                        return `<div class="autocomplete-suggestion" data-index="${index}" data-id="${item.id}" data-email="${item.email || ''}" data-student-id="${item.student_id || ''}">${highlighted}</div>`;
                    }).join('');
                    
                    // Attach click handlers to the newly created items
                    const suggestionItems = suggestionsEl.querySelectorAll('.autocomplete-suggestion');
                    suggestionItems.forEach((suggestionItem, index) => {
                        suggestionItem.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Clicked suggestion at index:', index);
                            if (studentAutocompleteSuggestions[index]) {
                                selectStudentFromAutocomplete(studentAutocompleteSuggestions[index], input, suggestionsEl);
                            }
                        });
                        // Make sure it's clickable
                        suggestionItem.style.cursor = 'pointer';
                    });
                    
                    console.log('Attached click handlers to', suggestionItems.length, 'suggestions');
                    
                    // Force visibility with inline styles and match input width exactly
                    const inputRect = input.getBoundingClientRect();
                    const inputWidth = inputRect.width || input.offsetWidth || input.clientWidth;
                    suggestionsEl.style.cssText = `display: block !important; visibility: visible !important; opacity: 1 !important; position: absolute !important; z-index: 9999 !important; background: #fff !important; border: 1px solid #ddd !important; width: ${inputWidth}px !important; left: 0 !important; right: auto !important; min-width: ${inputWidth}px !important; max-width: ${inputWidth}px !important;`;
                    suggestionsEl.style.display = 'block';
                    suggestionsEl.style.visibility = 'visible';
                    suggestionsEl.style.opacity = '1';
                    suggestionsEl.style.width = inputWidth + 'px';
                    suggestionsEl.style.minWidth = inputWidth + 'px';
                    suggestionsEl.style.maxWidth = inputWidth + 'px';
                    suggestionsEl.style.right = 'auto';
                    console.log('Set dropdown width to match input:', inputWidth + 'px (input rect width: ' + inputRect.width + 'px)');
                    
                    console.log('Autocomplete suggestions displayed:', data.length);
                    console.log('Suggestions HTML length:', suggestionsEl.innerHTML.length);
                    console.log('Element in DOM:', suggestionsEl.isConnected);
                    console.log('Element parent:', suggestionsEl.parentElement ? suggestionsEl.parentElement.tagName : 'none');
                    
                    // Check visibility after a brief delay
                    setTimeout(() => {
                        try {
                            // Re-query again to ensure we have the latest reference
                            const currentSuggestions = document.getElementById('studentAutocompleteList');
                            if (!currentSuggestions) {
                                console.error('Suggestions element disappeared from DOM');
                                return;
                            }
                            
                            if (!currentSuggestions.isConnected) {
                                console.error('Suggestions element is not connected to DOM - attempting to reconnect');
                                // Try to find the parent and re-append if needed
                                const formGroup = input.parentElement;
                                if (formGroup && formGroup.querySelector('#studentAutocompleteList') === null) {
                                    console.log('Re-appending suggestions element to form-group');
                                    formGroup.appendChild(currentSuggestions);
                                }
                                return;
                            }
                            
                            const computed = window.getComputedStyle(currentSuggestions);
                            const rect = currentSuggestions.getBoundingClientRect();
                            
                            console.log('Suggestions visibility check:', {
                                display: computed.display,
                                visibility: computed.visibility,
                                opacity: computed.opacity,
                                zIndex: computed.zIndex,
                                position: computed.position,
                                top: computed.top,
                                left: computed.left,
                                width: computed.width,
                                height: computed.height,
                                backgroundColor: computed.backgroundColor,
                                border: computed.border,
                                boundingRect: {
                                    top: rect.top,
                                    left: rect.left,
                                    width: rect.width,
                                    height: rect.height,
                                    visible: rect.height > 0 && rect.width > 0,
                                    bottom: rect.bottom,
                                    right: rect.right
                                },
                                offsetParent: currentSuggestions.offsetParent !== null,
                                innerHTMLLength: currentSuggestions.innerHTML.length
                            });
                            
                            // Log the actual visible dimensions
                            console.log('Dropdown dimensions:', {
                                width: rect.width + 'px',
                                height: rect.height + 'px',
                                top: rect.top + 'px',
                                left: rect.left + 'px',
                                isVisible: rect.height > 0 && rect.width > 0,
                                childrenCount: currentSuggestions.children.length
                            });
                            
                            if (rect.height === 0 || rect.width === 0 || rect.top === 0 && rect.left === 0 && rect.width === 0) {
                                console.error('Dropdown has zero dimensions or is off-screen');
                                
                                // Check parent containers
                                let parent = currentSuggestions.parentElement;
                                let level = 0;
                                while (parent && parent instanceof Element && level < 5) {
                                    try {
                                        const parentStyle = window.getComputedStyle(parent);
                                        const parentRect = parent.getBoundingClientRect();
                                        console.log(`Parent level ${level} (${parent.tagName}):`, {
                                            overflow: parentStyle.overflow,
                                            display: parentStyle.display,
                                            visibility: parentStyle.visibility,
                                            position: parentStyle.position,
                                            zIndex: parentStyle.zIndex,
                                            dimensions: {
                                                width: parentRect.width,
                                                height: parentRect.height
                                            }
                                        });
                                    } catch (e) {
                                        console.error(`Error getting style for parent level ${level}:`, e);
                                        break;
                                    }
                                    const nextParent = parent.parentElement;
                                    if (!nextParent || !(nextParent instanceof Element)) {
                                        break;
                                    }
                                    parent = nextParent;
                                    level++;
                                }
                            } else {
                                // Check if dropdown is actually visible on screen
                                const viewportHeight = window.innerHeight;
                                const viewportWidth = window.innerWidth;
                                const isOnScreen = rect.top >= 0 && rect.left >= 0 && 
                                                   rect.bottom <= viewportHeight && 
                                                   rect.right <= viewportWidth;
                                
                                console.log('Dropdown visibility details:', {
                                    dimensions: `${rect.width}x${rect.height}px`,
                                    position: `top: ${rect.top}px, left: ${rect.left}px`,
                                    visible: rect.height > 0 && rect.width > 0,
                                    onScreen: isOnScreen,
                                    viewport: `${viewportWidth}x${viewportHeight}px`,
                                    children: currentSuggestions.children.length,
                                    hasContent: currentSuggestions.innerHTML.length > 0,
                                    computedDisplay: computed.display,
                                    computedVisibility: computed.visibility,
                                    computedOpacity: computed.opacity,
                                    computedZIndex: computed.zIndex
                                });
                                
                                // If it has dimensions but isn't visible, check what's wrong
                                if (rect.height > 0 && rect.width > 0 && !isOnScreen) {
                                    console.warn('Dropdown has dimensions but is off-screen!');
                                }
                                if (rect.height === 0 || rect.width === 0) {
                                    console.error('Dropdown has zero dimensions despite being marked visible!');
                                    console.log('Element styles:', currentSuggestions.style.cssText);
                                    console.log('Element innerHTML length:', currentSuggestions.innerHTML.length);
                                }
                            }
                        } catch (e) {
                            console.error('Error checking visibility:', e);
                        }
                    }, 150);
                })
                .catch(error => {
                    console.error('Error fetching students:', error);
                    suggestions.style.display = 'none';
                    suggestions.innerHTML = '';
                });
        }, 300);
    });
    
    input.addEventListener('keydown', function(e) {
        if (suggestions.style.display === 'none' || suggestions.style.display === '') return;
        
        const items = suggestions.querySelectorAll('.autocomplete-suggestion');
        if (!items || items.length === 0) return;
        
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            studentAutocompleteSelectedIndex = Math.min(studentAutocompleteSelectedIndex + 1, items.length - 1);
            updateStudentSelection(items);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            studentAutocompleteSelectedIndex = Math.max(studentAutocompleteSelectedIndex - 1, -1);
            updateStudentSelection(items);
        } else if (e.key === 'Enter') {
            e.preventDefault();
            if (studentAutocompleteSelectedIndex >= 0 && studentAutocompleteSuggestions[studentAutocompleteSelectedIndex]) {
                selectStudentFromAutocomplete(studentAutocompleteSuggestions[studentAutocompleteSelectedIndex], input, suggestions);
            }
        } else if (e.key === 'Escape') {
            suggestions.style.display = 'none';
            studentAutocompleteSelectedIndex = -1;
        }
    });
    
    // Handle clicks on suggestions (using event delegation)
    // Note: We also attach handlers directly to items above, but this is a backup
    document.addEventListener('click', function(e) {
        const item = e.target.closest('.autocomplete-suggestion');
        if (item && item.closest('#studentAutocompleteList')) {
            const suggestionsEl = document.getElementById('studentAutocompleteList');
            if (suggestionsEl && suggestionsEl.style.display !== 'none') {
                const index = parseInt(item.dataset.index);
                if (studentAutocompleteSuggestions[index]) {
                    e.preventDefault();
                    e.stopPropagation();
                    selectStudentFromAutocomplete(studentAutocompleteSuggestions[index], input, suggestionsEl);
                }
            }
        }
    });
    
    function updateStudentSelection(items) {
        items.forEach((item, index) => {
            if (index === studentAutocompleteSelectedIndex) {
                item.classList.add('autocomplete-active');
                item.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
            } else {
                item.classList.remove('autocomplete-active');
            }
        });
    }
    
    function selectStudentFromAutocomplete(item, inputEl, suggestionsEl) {
        console.log('selectStudentFromAutocomplete called with:', item);
        const displayText = item.display || `${item.name} (${item.student_id})`;
        
        // Get fresh reference to input element
        const currentInput = document.getElementById('studentInput');
        if (currentInput) {
            currentInput.value = displayText;
            console.log('Set input value to:', displayText);
        } else {
            console.error('Input element not found');
        }
        
        // Update hidden fields
        const selectedStudentIdEl = document.getElementById('selectedStudentId');
        const selectedStudentEmailEl = document.getElementById('selectedStudentEmail');
        if (selectedStudentIdEl) {
            selectedStudentIdEl.value = item.id || '';
            console.log('Set selectedStudentId to:', item.id);
        }
        if (selectedStudentEmailEl) {
            selectedStudentEmailEl.value = item.email || '';
            console.log('Set selectedStudentEmail to:', item.email);
        }
        
        // Hide suggestions
        const currentSuggestions = document.getElementById('studentAutocompleteList');
        if (currentSuggestions) {
            currentSuggestions.style.display = 'none';
            currentSuggestions.innerHTML = '';
        }
        if (suggestionsEl) {
            suggestionsEl.style.display = 'none';
            suggestionsEl.innerHTML = '';
        }
        
        studentAutocompleteSelectedIndex = -1;
        console.log('Student selection complete');
    }
    
    // Close autocomplete when clicking outside
    document.addEventListener('click', function(e) {
        if (!input.parentNode.contains(e.target) && e.target !== input) {
            suggestions.style.display = 'none';
        }
    });
    
    console.log('Student autocomplete initialized successfully');
    
    // Test if elements are accessible
    if (input && suggestions) {
        console.log('Input and suggestions elements found and ready');
    } else {
        console.error('Missing elements:', { input: !!input, suggestions: !!suggestions });
    }
}

// Client-side Autocomplete (Scholarships)
function setupClientSideAutocomplete(inp, arr) {
    let currentFocus;
    inp.addEventListener("input", function(e) {
        let val = this.value;
        closeAllLists();
        if (!val) {
             document.getElementById('scholarshipId').value = ''; // Clear ID if input cleared
             return false;
        }
        currentFocus = -1;
        
        const listDiv = document.createElement("DIV");
        listDiv.setAttribute("id", this.id + "autocomplete-list");
        listDiv.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(listDiv);
        
        arr.forEach(item => {
            const display = `${item.code} - ${item.title} (${item.applications_count} applicants)`;
            if (display.toUpperCase().includes(val.toUpperCase())) {
                const div = document.createElement("DIV");
                const regex = new RegExp(`(${val})`, "gi");
                div.innerHTML = display.replace(regex, "<strong>$1</strong>");
                div.innerHTML += `<input type='hidden' value='${display}' data-id='${item.id}'>`;
                div.addEventListener("click", function(e) {
                    inp.value = this.getElementsByTagName("input")[0].value;
                    document.getElementById('scholarshipId').value = this.getElementsByTagName("input")[0].dataset.id;
                    closeAllLists();
                });
                listDiv.appendChild(div);
            }
        });
    });
    
    inp.addEventListener("keydown", function(e) {
        let x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) { currentFocus++; addActive(x); }
        else if (e.keyCode == 38) { currentFocus--; addActive(x); }
        else if (e.keyCode == 13) { e.preventDefault(); if (currentFocus > -1 && x) x[currentFocus].click(); }
    });
    
    function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
    }
    function removeActive(x) {
        for (let i = 0; i < x.length; i++) x[i].classList.remove("autocomplete-active");
    }
    function closeAllLists(elmnt) {
        const x = document.getElementsByClassName("autocomplete-items");
        for (let i = 0; i < x.length; i++) {
            if (elmnt != x[i] && elmnt != inp) x[i].parentNode.removeChild(x[i]);
        }
    }
    document.addEventListener("click", function (e) { closeAllLists(e.target); });
}

// History and Search
let searchTimeout;
function debounceHistorySearch() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(loadAnnouncementHistory, 500);
}

function loadAnnouncementHistory() {
    const query = document.getElementById('historySearch') ? document.getElementById('historySearch').value : '';
    fetch(`/provider/api/announcements/history?search=${encodeURIComponent(query)}`)
        .then(r => r.json())
        .then(data => {
            const container = document.getElementById('announcementHistoryList');
            if (data.success && data.announcements && data.announcements.length > 0) {
                announcementsCache = data.announcements;
                container.innerHTML = data.announcements.map((ann, index) => `
                    <div onclick="openAnnouncementDetails(${index})" style="background: #f8f9fa; border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid ${ann.type === 'broadcast' ? '#0072ce' : '#28a745'}; cursor: pointer; transition: background 0.2s;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom: 0.5rem;">
                                    ${ann.type === 'broadcast' 
                                        ? '<span style="background: #0072ce; color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">Broadcast</span>' 
                                        : '<span style="background: #28a745; color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">Individual</span>'}
                                    <span style="color: #999; font-size: 0.8rem;">${ann.created_at}</span>
                                </div>
                                <h4 style="color: #333; margin: 0 0 0.25rem 0; font-size: 1.1rem;">${ann.title}</h4>
                                <div style="color: #666; font-size: 0.9rem;">
                                    <strong>To:</strong> ${ann.recipient_filter}
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <i class="fas fa-search" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <h3 style="color: #003366; margin-bottom: 0.5rem;">No Announcements Found</h3>
                        <p>Try a different search term or send a new announcement.</p>
                    </div>
                `;
            }
        })
        .catch(err => console.error('Error loading history:', err));
}

function openAnnouncementDetails(index) {
    const ann = announcementsCache[index];
    if (!ann) return;
    
    const body = document.getElementById('announcementSuccessBody');
    const modal = document.getElementById('announcementSuccessModal');
    
    modal.querySelector('.modal-title').textContent = "Announcement Details";
    
    body.innerHTML = `
        <div style="display:grid; gap:1rem;">
            <div>
                <label style="font-weight:600; color:#666; font-size:0.9rem;">Title</label>
                <div style="font-size:1.1rem; color:#333; font-weight:600;">${ann.title}</div>
            </div>
            <div style="display:flex; gap:2rem;">
                <div>
                    <label style="font-weight:600; color:#666; font-size:0.9rem;">Type</label>
                    <div style="text-transform:capitalize;">${ann.type}</div>
                </div>
                <div>
                    <label style="font-weight:600; color:#666; font-size:0.9rem;">Date</label>
                    <div>${ann.created_at_full}</div>
                </div>
            </div>
            <div>
                <label style="font-weight:600; color:#666; font-size:0.9rem;">Recipients</label>
                <div>${ann.recipient_filter} (${ann.count} recipient${ann.count !== 1 ? 's' : ''})</div>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:0;">
            <div>
                <label style="font-weight:600; color:#666; font-size:0.9rem;">Message</label>
                <div style="background:#f8f9fa; padding:1rem; border-radius:8px; line-height:1.6; margin-top:0.5rem;">
                    ${ann.message.replace(/\n/g, '<br>')}
                </div>
            </div>
        </div>
    `;
    
    modal.style.display = 'block';
}

function closeAnnouncementSuccess() {
    document.getElementById('announcementSuccessModal').style.display = 'none';
    setTimeout(() => {
        const modal = document.getElementById('announcementSuccessModal');
        if (modal) modal.querySelector('.modal-title').textContent = "Announcement Sent";
    }, 300);
}

window.onclick = function(event) {
    const modal = document.getElementById('announcementSuccessModal');
    if (event.target === modal) {
        closeAnnouncementSuccess();
    }
}

// Listen for profile picture updates
window.addEventListener('profilePictureUpdated', function(e) {
    const sidebarImg = document.getElementById('sidebarProfilePicture');
    if (sidebarImg && e.detail && e.detail.imageUrl) {
        sidebarImg.src = e.detail.imageUrl;
    }
});

window.addEventListener('storage', function(e) {
    if (e.key === 'provider_profile_picture_url') {
        const sidebarImg = document.getElementById('sidebarProfilePicture');
        if (sidebarImg && e.newValue) {
            sidebarImg.src = e.newValue;
        }
    }
});
</script>

<!-- Provider Guidelines Modal -->
<div id="providerGuidelinesModal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow: auto;">
    <div style="background: #fff; margin: 5% auto; padding: 0; border-radius: 15px; width: 90%; max-width: 700px; max-height: 85vh; display: flex; flex-direction: column; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
        <div style="padding: 1.5rem 2rem; border-bottom: 2px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
            <h2 style="margin: 0; color: #003366; font-size: 1.8rem;">Provider Portal Guidelines</h2>
            <button onclick="closeProviderGuidelinesModal()" style="background: none; border: none; font-size: 1.8rem; color: #666; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <div style="padding: 2rem; overflow-y: auto; flex: 1;">
            <h3 style="color: #003366; margin-bottom: 1.5rem; font-size: 1.5rem;">Guidelines for Provider</h3>
            <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    In your dashboard, you can see brief info of the scholarships and number of applicants.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    You can also send announcement to your offered scholarship to those who applied or to a specific student.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    You can create scholarship in "Manage Scholarships". Once created it's marked as draft and click publish to go online. You can also view, update, create a PDF report, and archive.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    Another list will appear if you archive. You can create a PDF report of it as well.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    Once archived, the students who are approved/applying the scholarship will be removed. You can restore it and those students will have to apply again if they want to. An update will be sent to the students accordingly.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    You can check the application of the students of the scholarship you created and view their details. Approve their documents. Approval can happen when you verified all the documents. You can reject anytime.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    You can set appointments to student in schedule page, multiple scheduled appointment can be sent to the student.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    In documents you can search student name or id to check their document, you can check even all the students available even if they are not on your scholarship and you can only view their document.
                </li>
                <li style="margin-bottom: 1rem; padding-left: 1.5rem; position: relative; line-height: 1.6;">
                    <span style="position: absolute; left: 0; color: #0072ce; font-weight: bold;"></span>
                    In Organization is where your information is and you can update it as well.
                </li>
            </ul>
        </div>
    </div>
</div>

<script>
function openProviderGuidelinesModal() {
    document.getElementById('providerGuidelinesModal').style.display = 'block';
}

function closeProviderGuidelinesModal() {
    document.getElementById('providerGuidelinesModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('providerGuidelinesModal');
    if (event.target == modal) {
        closeProviderGuidelinesModal();
    }
}
</script>
{% endblock %}
