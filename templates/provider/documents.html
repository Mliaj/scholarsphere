{% extends "base.html" %}

{% block title %}Documents - Scholarsphere | Provider{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
<style>
    .dashboard-container { display:flex; min-height:100vh; }
    .sidebar { width:280px; background: linear-gradient(135deg, #003366 0%, #0072ce 100%); color:#fff; padding:2rem 0; position:fixed; height:100vh; overflow-y:auto; }
    .sidebar-header { text-align:center; padding:0 2rem 2rem 2rem; border-bottom:1px solid rgba(255,255,255,0.1); }
    .sidebar-logo { width:60px; height:60px; background:#fff; border-radius:50%; margin:0 auto 1rem; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .sidebar-logo img { width:100%; height:100%; object-fit:cover; border-radius:50%; }
    .sidebar-brand { font-size:1.2rem; font-weight:700; margin-bottom:.5rem; }
    .sidebar-subtitle { font-size:.9rem; opacity:.8; }
    .sidebar-nav { padding:2rem 0; }
    .nav-item { padding:1rem 2rem; cursor:pointer; transition:background .3s; border-left:3px solid transparent; }
    .nav-item:hover, .nav-item.active { background:rgba(255,255,255,0.1); border-left-color:#ffc72c; }
    .nav-item i { margin-right:1rem; width:20px; }

    .main-content { flex:1; margin-left:280px; padding:2rem; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; padding:1rem 0; }
    .welcome-text h1 { font-size:2rem; color:#003366; margin-bottom:.5rem; }
    .welcome-text p { color:#666; }
    
    /* Search container styles */
    .search-container { transition: all 0.3s ease; }
    .search-container.centered { 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        min-height: 60vh; 
        margin: 0;
    }
    .search-container.top { 
        margin-bottom: 2rem; 
    }
    .search-wrapper {
        width: 100%;
        max-width: 600px;
        transition: all 0.3s ease;
    }
    .search-wrapper.centered {
        text-align: center;
    }
    .search-wrapper.top {
        text-align: left;
    }
    #docSearch {
        width: 100%;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        border: 2px solid #ddd;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    #docSearch:focus {
        outline: none;
        border-color: #0072ce;
        box-shadow: 0 4px 20px rgba(0, 114, 206, 0.15);
    }
    .search-placeholder {
        margin-top: 1rem;
        color: #666;
        font-size: 0.95rem;
    }
    
    .document-section { background:#fff; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.08); margin-bottom:2rem; padding:1.5rem; }
    .document-header { display:flex; justify-content:space-between; align-items:start; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:2px solid #e9ecef; }
    .student-info h3 { color:#003366; margin-bottom:.25rem; }
    .student-info p { color:#666; margin:.25rem 0; }
    .badge { padding:.25rem .6rem; border-radius:20px; font-size:.85rem; font-weight:600; }
    .badge.complete { background:#d4edda; color:#155724; }
    .badge.incomplete { background:#f8d7da; color:#721c24; }
    
    .documents-list { display:grid; gap:1rem; }
    .document-item { padding:1rem; background:#f8f9fa; border-radius:10px; border:1px solid #e9ecef; display:flex; justify-content:space-between; align-items:center; }
    .document-info h4 { font-weight:600; color:#333; margin-bottom:.25rem; }
    .document-info p { color:#666; font-size:.9rem; margin:0; }
    .btn-view { background:#007bff; color:#fff; padding:.5rem 1rem; border-radius:8px; border:none; cursor:pointer; font-weight:600; font-size:.9rem; }
    
    .no-documents { text-align:center; padding:2rem; color:#666; }
    
    .results-container { 
        animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @media (max-width:1024px){ .sidebar{width:250px;} .main-content{margin-left:250px;} }
    @media (max-width:768px){ .sidebar{transform:translateX(-100%);} .main-content{margin-left:0;} }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        {% if user.profile_picture %}
          <img id="sidebarProfilePicture" src="{{ url_for('static', filename='uploads/profile_pictures/' + user.profile_picture) }}" alt="Profile Picture">
        {% else %}
          <img id="sidebarProfilePicture" src="{{ url_for('static', filename='images/uc-logo.png') }}" alt="UC Logo">
        {% endif %}
      </div>
      <div class="sidebar-brand">Scholarsphere</div>
      <div class="sidebar-subtitle">Provider Portal</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.dashboard') }}'"><i class="fas fa-home"></i> Dashboard</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.scholarships') }}'"><i class="fas fa-graduation-cap"></i> Manage Scholarships</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.applications') }}'"><i class="fas fa-clipboard-list"></i> Applications</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.schedules') }}'"><i class="fas fa-calendar-alt"></i> Schedules</div>
      <div class="nav-item active"><i class="fas fa-file-alt"></i> Documents</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.profile') }}'"><i class="fas fa-building"></i> Organization Profile</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('logout') }}'"><i class="fas fa-sign-out-alt"></i> Logout</div>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="top-bar">
      <div class="welcome-text">
        <h1>Application Documents</h1>
        <p>Review documents submitted by students</p>
      </div>
    </div>

    <!-- Search Bar Container -->
    <div class="search-container centered" id="searchContainer">
      <div class="search-wrapper centered" id="searchWrapper">
        <input type="text" id="docSearch" placeholder="Search by student name or ID...">
        <div class="search-placeholder" id="searchPlaceholder">
          <i class="fas fa-search" style="font-size: 2rem; color: #ddd; margin-bottom: 0.5rem; display: block;"></i>
          <p>Enter a student name or ID to search for documents</p>
        </div>
      </div>
    </div>

    <!-- Results Container -->
    <div id="resultsContainer" class="results-container" style="display: none;">
      <div id="documentsContainer">
      {% if documents %}
        {% for doc in documents %}
        <div class="document-section" data-student-name="{{ doc.student_name.lower() }}" data-student-id="{{ doc.student_id }}" style="display: none;">
          <div class="document-header">
            <div class="student-info">
              <h3>{{ doc.student_name }}</h3>
              {% if doc.student_id %}
              <p style="color:#0072ce; font-weight:600;">ID: {{ doc.student_id }}</p>
              {% endif %}
              <p><strong>Application:</strong> {{ doc.application_id }}</p>
              <p><strong>Scholarship:</strong> {{ doc.scholarship_code }} - {{ doc.scholarship_title }}</p>
              <p><strong>Status:</strong> {{ doc.status }}</p>
            </div>
            <div>
              <span class="badge {{ doc.completion_status.lower() }}">{{ doc.completion_status }}</span>
              <p style="margin-top:.5rem; color:#666; font-size:.9rem;">{{ doc.document_count }} document(s)</p>
            </div>
          </div>
          
          {% if doc.documents %}
          <div class="documents-list">
            {% for document in doc.documents %}
            <div class="document-item">
              <div class="document-info">
                <h4>{{ document.requirement_type }}</h4>
                <p>{{ document.file_name }} ({{ document.credential_type }})</p>
              </div>
              <button class="btn-view" onclick="window.open('/static/uploads/credentials/{{ document.file_path }}', '_blank')">
                <i class="fas fa-eye"></i> View
              </button>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="no-documents">
            <i class="fas fa-file-alt" style="font-size:3rem; color:#ddd; margin-bottom:1rem;"></i>
            <p>No documents uploaded yet.</p>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      {% else %}
        <div style="text-align:center; padding:4rem; background:#fff; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.08);">
          <i class="fas fa-folder-open" style="font-size:4rem; color:#ddd; margin-bottom:1rem;"></i>
          <h3 style="color:#003366; margin-bottom:.5rem;">No Applications Yet</h3>
          <p style="color:#666;">No students have submitted applications yet.</p>
        </div>
      {% endif %}
      </div>
      <div id="noResults" style="display:none; text-align:center; padding:3rem; color:#666;">
        <i class="fas fa-search" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
        <p>No matching documents found.</p>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('docSearch');
  const searchContainer = document.getElementById('searchContainer');
  const searchWrapper = document.getElementById('searchWrapper');
  const searchPlaceholder = document.getElementById('searchPlaceholder');
  const resultsContainer = document.getElementById('resultsContainer');
  const documentsContainer = document.getElementById('documentsContainer');
  const noResults = document.getElementById('noResults');
  
  // Initially hide all documents
  const sections = document.querySelectorAll('.document-section');
  sections.forEach(section => {
    section.style.display = 'none';
  });
  
  function performSearch() {
    const query = searchInput.value.toLowerCase().trim();
    let hasMatch = false;
    let visibleCount = 0;

    sections.forEach(section => {
      const name = section.getAttribute('data-student-name') || '';
      const id = section.getAttribute('data-student-id') || '';
      
      if (query === '' || name.includes(query) || id.includes(query)) {
        section.style.display = '';
        if (query !== '') {
          hasMatch = true;
          visibleCount++;
        }
      } else {
        section.style.display = 'none';
      }
    });

    // If search query exists and has results
    if (query !== '') {
      // Move search to top
      searchContainer.classList.remove('centered');
      searchContainer.classList.add('top');
      searchWrapper.classList.remove('centered');
      searchWrapper.classList.add('top');
      searchPlaceholder.style.display = 'none';
      resultsContainer.style.display = 'block';
      
      // Show/hide no results message
      if (visibleCount === 0) {
        noResults.style.display = 'block';
        documentsContainer.style.display = 'none';
      } else {
        noResults.style.display = 'none';
        documentsContainer.style.display = 'block';
      }
    } else {
      // Reset to centered state
      searchContainer.classList.remove('top');
      searchContainer.classList.add('centered');
      searchWrapper.classList.remove('top');
      searchWrapper.classList.add('centered');
      searchPlaceholder.style.display = 'block';
      resultsContainer.style.display = 'none';
      noResults.style.display = 'none';
    }
  }
  
  searchInput.addEventListener('input', performSearch);
  searchInput.addEventListener('keyup', performSearch);
  
  // Handle Enter key
  searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      performSearch();
    }
  });
});

// Listen for profile picture updates across tabs
window.addEventListener('storage', function(e) {
    if (e.key === 'provider_profile_picture_url') {
        const sidebarImg = document.getElementById('sidebarProfilePicture');
        if (sidebarImg && e.newValue) {
            sidebarImg.src = e.newValue;
        }
    }
});

// Listen for profile picture updates on same page
window.addEventListener('profilePictureUpdated', function(e) {
    const sidebarImg = document.getElementById('sidebarProfilePicture');
    if (sidebarImg && e.detail && e.detail.imageUrl) {
        sidebarImg.src = e.detail.imageUrl;
    }
});
</script>
{% endblock %}


