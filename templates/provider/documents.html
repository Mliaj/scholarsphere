{% extends "base.html" %}

{% block title %}Documents - Scholarsphere | Provider{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
<style>
    .dashboard-container { display:flex; min-height:100vh; }
    .sidebar { width:280px; background: linear-gradient(135deg, #003366 0%, #0072ce 100%); color:#fff; padding:2rem 0; position:fixed; height:100vh; overflow-y:auto; }
    .sidebar-header { text-align:center; padding:0 2rem 2rem 2rem; border-bottom:1px solid rgba(255,255,255,0.1); }
    .sidebar-logo { width:60px; height:60px; background:#fff; border-radius:50%; margin:0 auto 1rem; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .sidebar-logo img { width:50px; height:50px; object-fit:cover; border-radius:50%; }
    .sidebar-brand { font-size:1.2rem; font-weight:700; margin-bottom:.5rem; }
    .sidebar-subtitle { font-size:.9rem; opacity:.8; }
    .sidebar-nav { padding:2rem 0; }
    .nav-item { padding:1rem 2rem; cursor:pointer; transition:background .3s; border-left:3px solid transparent; }
    .nav-item:hover, .nav-item.active { background:rgba(255,255,255,0.1); border-left-color:#ffc72c; }
    .nav-item i { margin-right:1rem; width:20px; }

    .main-content { flex:1; margin-left:280px; padding:2rem; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; padding:1rem 0; }
    .welcome-text h1 { font-size:2rem; color:#003366; margin-bottom:.5rem; }
    .welcome-text p { color:#666; }
    
    .document-section { background:#fff; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.08); margin-bottom:2rem; padding:1.5rem; }
    .document-header { display:flex; justify-content:space-between; align-items:start; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:2px solid #e9ecef; }
    .student-info h3 { color:#003366; margin-bottom:.25rem; }
    .student-info p { color:#666; margin:.25rem 0; }
    .badge { padding:.25rem .6rem; border-radius:20px; font-size:.85rem; font-weight:600; }
    .badge.complete { background:#d4edda; color:#155724; }
    .badge.incomplete { background:#f8d7da; color:#721c24; }
    
    .documents-list { display:grid; gap:1rem; }
    .document-item { padding:1rem; background:#f8f9fa; border-radius:10px; border:1px solid #e9ecef; display:flex; justify-content:space-between; align-items:center; }
    .document-info h4 { font-weight:600; color:#333; margin-bottom:.25rem; }
    .document-info p { color:#666; font-size:.9rem; margin:0; }
    .btn-view { background:#007bff; color:#fff; padding:.5rem 1rem; border-radius:8px; border:none; cursor:pointer; font-weight:600; font-size:.9rem; }
    
    .no-documents { text-align:center; padding:2rem; color:#666; }
    
    @media (max-width:1024px){ .sidebar{width:250px;} .main-content{margin-left:250px;} }
    @media (max-width:768px){ .sidebar{transform:translateX(-100%);} .main-content{margin-left:0;} }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <img src="{{ url_for('static', filename='images/uc-logo.png') }}" alt="UC Logo">
      </div>
      <div class="sidebar-brand">Scholarsphere</div>
      <div class="sidebar-subtitle">Provider Portal</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.dashboard') }}'"><i class="fas fa-home"></i> Dashboard</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.scholarships') }}'"><i class="fas fa-graduation-cap"></i> Manage Scholarships</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.applications') }}'"><i class="fas fa-clipboard-list"></i> Applications</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.schedules') }}'"><i class="fas fa-calendar-alt"></i> Schedules</div>
      <div class="nav-item active"><i class="fas fa-file-alt"></i> Documents</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('provider.profile') }}'"><i class="fas fa-building"></i> Organization Profile</div>
      <div class="nav-item" onclick="window.location.href='{{ url_for('logout') }}'"><i class="fas fa-sign-out-alt"></i> Logout</div>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="top-bar">
      <div class="welcome-text">
        <h1>Application Documents</h1>
        <p>Review documents submitted by students</p>
      </div>
    </div>

    <!-- Search Bar -->
    <div style="margin-bottom: 2rem;">
      <input type="text" id="docSearch" class="form-control" placeholder="Search by student name or ID..." style="max-width: 400px; padding: 0.8rem; border-radius: 10px; border: 1px solid #ddd; font-size: 1rem;">
    </div>

    <div id="documentsContainer">
      {% if documents %}
        {% for doc in documents %}
        <div class="document-section" data-student-name="{{ doc.student_name.lower() }}" data-student-id="{{ doc.student_id }}">
          <div class="document-header">
            <div class="student-info">
              <h3>{{ doc.student_name }}</h3>
              {% if doc.student_id %}
              <p style="color:#0072ce; font-weight:600;">ID: {{ doc.student_id }}</p>
              {% endif %}
              <p><strong>Application:</strong> {{ doc.application_id }}</p>
              <p><strong>Scholarship:</strong> {{ doc.scholarship_code }} - {{ doc.scholarship_title }}</p>
              <p><strong>Status:</strong> {{ doc.status }}</p>
            </div>
            <div>
              <span class="badge {{ doc.completion_status.lower() }}">{{ doc.completion_status }}</span>
              <p style="margin-top:.5rem; color:#666; font-size:.9rem;">{{ doc.document_count }} document(s)</p>
            </div>
          </div>
          
          {% if doc.documents %}
          <div class="documents-list">
            {% for document in doc.documents %}
            <div class="document-item">
              <div class="document-info">
                <h4>{{ document.requirement_type }}</h4>
                <p>{{ document.file_name }} ({{ document.credential_type }})</p>
              </div>
              <button class="btn-view" onclick="window.open('/static/uploads/credentials/{{ document.file_path }}', '_blank')">
                <i class="fas fa-eye"></i> View
              </button>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="no-documents">
            <i class="fas fa-file-alt" style="font-size:3rem; color:#ddd; margin-bottom:1rem;"></i>
            <p>No documents uploaded yet.</p>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      {% else %}
        <div style="text-align:center; padding:4rem; background:#fff; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.08);">
          <i class="fas fa-folder-open" style="font-size:4rem; color:#ddd; margin-bottom:1rem;"></i>
          <h3 style="color:#003366; margin-bottom:.5rem;">No Applications Yet</h3>
          <p style="color:#666;">No students have submitted applications yet.</p>
        </div>
      {% endif %}
    </div>
    <div id="noResults" style="display:none; text-align:center; padding:3rem; color:#666;">
      <i class="fas fa-search" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
      <p>No matching documents found.</p>
    </div>
  </div>
</div>

<script>
document.getElementById('docSearch').addEventListener('keyup', function() {
  const query = this.value.toLowerCase().trim();
  const sections = document.querySelectorAll('.document-section');
  let hasMatch = false;

  sections.forEach(section => {
    const name = section.getAttribute('data-student-name') || '';
    const id = section.getAttribute('data-student-id') || '';
    
    if (name.includes(query) || id.includes(query)) {
      section.style.display = '';
      hasMatch = true;
    } else {
      section.style.display = 'none';
    }
  });

  document.getElementById('noResults').style.display = (hasMatch || sections.length === 0) ? 'none' : 'block';
});
</script>
{% endblock %}


